<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #eef2f5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- –ù–ê–í–ò–ì–ê–¶–ò–Ø --- */
        .navbar { background: #2c3e50 !important; height: 50px; flex-shrink: 0; }
        .navbar-brand { font-size: 1rem; font-weight: bold; }
        .nav-link { font-size: 0.9rem; }

        /* --- –ö–û–ù–¢–ï–ô–ù–ï–† –õ–ò–°–¢–ê --- */
        .schedule-wrapper {
            flex: 1;
            overflow: auto; /* –°–∫—Ä–æ–ª–ª —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .paper-sheet {
            width: 85%; /* –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
            max-width: 1600px;
            min-width: 900px;
            background: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-radius: 4px;
            overflow: hidden; /* –ß—Ç–æ–±—ã —É–≥–ª—ã –±—ã–ª–∏ –∫—Ä—É–≥–ª—ã–º–∏ */
        }

        /* --- –¢–ê–ë–õ–ò–¶–ê --- */
        .timetable {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed; /* –ì–õ–ê–í–ù–û–ï: –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ */
        }

        .timetable th {
            background-color: #34495e;
            color: #ecf0f1;
            padding: 8px;
            text-align: center;
            font-size: 0.8rem;
            text-transform: uppercase;
            border-right: 1px solid #4e6072;
            height: 40px;
        }

        .col-num { width: 40px; background: #dfe6e9; color: #636e72; border-right: 1px solid #b2bec3; font-weight: bold; text-align: center;}

        /* --- –Ø–ß–ï–ô–ö–ê --- */
        .timetable td {
            border: 1px solid #dfe6e9;
            height: 90px; /* –°–¢–†–û–ì–ê–Ø –í–´–°–û–¢–ê –Ø–ß–ï–ô–ö–ò */
            padding: 0;
            vertical-align: top;
            overflow: hidden; /* –û–±—Ä–µ–∑–∞–µ–º, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ —Ç–æ—Ä—á–∏—Ç */
        }

        /* –í–ù–£–¢–†–ï–ù–ù–ò–ô –ö–û–ù–¢–ï–ô–ù–ï–† –Ø–ß–ï–ô–ö–ò (–°–∫—Ä–æ–ª–ª —Ç—É—Ç) */
        .cell-content {
            height: 100%;
            width: 100%;
            overflow-y: auto; /* –ï—Å–ª–∏ —É—Ä–æ–∫–æ–≤ –º–Ω–æ–≥–æ - —Å–∫—Ä–æ–ª–ª */
            display: flex;
            flex-direction: column;
            gap: 2px;
            padding: 2px;
        }

        /* –¢–æ–Ω–∫–∏–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
        .cell-content::-webkit-scrollbar { width: 4px; }
        .cell-content::-webkit-scrollbar-thumb { background-color: #bdc3c7; border-radius: 2px; }

        /* --- –ö–ê–†–¢–û–ß–ö–ê –£–†–û–ö–ê --- */
        .lesson-block {
            flex-shrink: 0; /* –ù–µ —Å–∂–∏–º–∞—Ç—å */
            min-height: 84px; /* –ó–∞–Ω–∏–º–∞–µ—Ç –ø–æ—á—Ç–∏ –≤—Å—é —è—á–µ–π–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 4px 6px;
            border-radius: 3px;
            font-size: 0.85rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: background 0.1s;
        }

        /* –ï—Å–ª–∏ –≤ –∫–ª–µ—Ç–∫–µ –º–Ω–æ–≥–æ —É—Ä–æ–∫–æ–≤ (–≤–∞–∫–∞–Ω—Å–∏—è), –¥–µ–ª–∞–µ–º –∏—Ö –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ */
        .cell-content:has(> .lesson-block:nth-child(2)) .lesson-block {
            min-height: 40px; /* –£–º–µ–Ω—å—à–∞–µ–º –≤—ã—Å–æ—Ç—É */
            justify-content: center;
        }

        .lesson-header { display: flex; justify-content: space-between; font-weight: 700; color: #2c3e50; }
        .lesson-body { font-size: 0.8rem; color: #555; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .room-badge {
            background: white;
            padding: 0 4px;
            border-radius: 3px;
            color: #c0392b;
            font-weight: bold;
            font-size: 0.75rem;
            box-shadow: 0 1px 1px rgba(0,0,0,0.1);
        }

        /* –¶–≤–µ—Ç–∞ */
        .sub-1 { background-color: #fff3e0; border-left-color: #f39c12; }
        .sub-2 { background-color: #e8f5e9; border-left-color: #27ae60; }

        .empty-text { color: #ecf0f1; font-size: 2rem; text-align: center; margin-top: 20px; font-weight: bold; }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark sticky-top">
  <div class="container-fluid px-4">
    <a class="navbar-brand" href="/">üìÖ –õ–∏—Ü–µ–π</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav me-auto">
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle active" href="#" id="tDrop" role="button" data-bs-toggle="dropdown">üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—è</a>
          <ul class="dropdown-menu" aria-labelledby="tDrop" style="max-height: 80vh; overflow-y: auto;">
            {% for t in all_teachers %}
            <li><a class="dropdown-item" href="/teacher/{{ t.id }}">{{ t.name }}</a></li>
            {% endfor %}
          </ul>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="gDrop" role="button" data-bs-toggle="dropdown">üéì –ö–ª–∞—Å—Å—ã</a>
          <ul class="dropdown-menu" aria-labelledby="gDrop" style="max-height: 80vh; overflow-y: auto;">
            {% for g in all_groups %}
            <li><a class="dropdown-item" href="/group/{{ g.id }}">{{ g.name }}</a></li>
            {% endfor %}
          </ul>
        </li>
      </ul>
      <div class="d-flex gap-2">
          <a href="/import" class="btn btn-outline-light btn-sm">‚öôÔ∏è</a>
          <form action="/generate" method="post" class="mb-0">
             <button class="btn btn-success btn-sm" type="submit">‚ö° –ì–µ–Ω–µ—Ä–∞—Ü–∏—è</button>
          </form>
      </div>
    </div>
  </div>
</nav>

<div class="schedule-wrapper">
    {% if not schedule_grid %}
        <div class="text-center mt-5 text-muted">
            <h3>üëà –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤ –º–µ–Ω—é —Å–≤–µ—Ä—Ö—É</h3>
        </div>
    {% else %}

    <div class="paper-sheet">
        <div class="p-2 border-bottom bg-light d-flex justify-content-between align-items-center">
            <h6 class="m-0 text-dark fw-bold px-3">{{ title }}</h6>
            <small class="text-muted px-3">13 —É—Ä–æ–∫–æ–≤</small>
        </div>

        <table class="timetable">
            <thead>
                <tr>
                    <th class="col-num">#</th>
                    <th>–ü–Ω</th>
                    <th>–í—Ç</th>
                    <th>–°—Ä</th>
                    <th>–ß—Ç</th>
                    <th>–ü—Ç</th>
                </tr>
            </thead>
            <tbody>
                {% for period in range(1, 14) %}
                <tr>
                    <td class="col-num">{{ period }}</td>
                    {% for day in range(1, 6) %}
                    <td>
                        <div class="cell-content">
                            {% set lessons = schedule_grid.get((day, period), []) %}

                            {% for lesson in lessons %}
                            <div class="lesson-block {% if '(–ì—Ä. 1)' in lesson.subject %}sub-1{% elif '(–ì—Ä. 2)' in lesson.subject %}sub-2{% endif %}">
                                <div class="lesson-header">
                                    <span>
                                        {% if show_group_name %}{{ lesson.group }}{% endif %}
                                        {% if show_teacher_name %}{{ lesson.teacher }}{% endif %}
                                    </span>
                                    <span class="room-badge">{{ lesson.room }}</span>
                                </div>
                                <div class="lesson-body">
                                    {{ lesson.subject }}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>